<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>åšå®¢å¼€å¼ ï¼šè®°å½•æœ¬å¤§å­¦ç”Ÿåç«¯å¼€å‘çš„æ€è€ƒä¸æˆé•¿</title>
    <url>/2024/11/03/2024-11-03-my-first-blog-post/</url>
    <content><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>ä»Šå¤©æ˜¯æˆ‘å¼€å§‹å†™åšå®¢çš„ç¬¬ä¸€å¤©ï¼ˆç»ˆäºä¸‹å®šå†³å¿ƒäº†ï¼ï¼‰ã€‚ä½œä¸ºä¸€ååç«¯å¼€å‘å­¦ä¹ è€…ï¼Œæˆ‘å†³å®šç”¨è¿™ä¸ªåšå®¢è®°å½•æˆ‘åœ¨å¼€å‘è¿‡ç¨‹ä¸­çš„æ€è€ƒã€è¸©è¿‡çš„å‘ä»¥åŠæ”¶è·ã€‚è™½ç„¶ä¸çŸ¥é“èƒ½åšæŒå¤šä¹…ï¼Œä½†è‡³å°‘å…ˆå¼€å§‹å§ ğŸ˜…</p>
<h2 id="ä¸ºä»€ä¹ˆè¦å†™åšå®¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦å†™åšå®¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å†™åšå®¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦å†™åšå®¢ï¼Ÿ</h2><ol>
<li><strong>çŸ¥è¯†æ²‰æ·€</strong>ï¼šæŠŠé›¶æ•£çš„çŸ¥è¯†ç‚¹æ•´ç†æˆä½“ç³»åŒ–çš„æ–‡ç« </li>
<li><strong>é—®é¢˜å¤ç›˜</strong>ï¼šè®°å½•debugè¿‡ç¨‹ï¼Œä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜èƒ½å¿«é€Ÿå®šä½</li>
<li><strong>æŠ€æœ¯æˆé•¿</strong>ï¼šé€šè¿‡å†™ä½œåŠ æ·±å¯¹æŠ€æœ¯çš„ç†è§£</li>
<li><strong>åˆ†äº«äº¤æµ</strong>ï¼šå¸Œæœ›èƒ½å¸®åŠ©åˆ°é‡åˆ°åŒæ ·é—®é¢˜çš„å¼€å‘è€…</li>
</ol>
<h2 id="åšå®¢å†…å®¹è§„åˆ’"><a href="#åšå®¢å†…å®¹è§„åˆ’" class="headerlink" title="åšå®¢å†…å®¹è§„åˆ’"></a>åšå®¢å†…å®¹è§„åˆ’</h2><p>è¿™ä¸ªåšå®¢ä¸»è¦ä¼šè®°å½•ï¼š</p>
<ul>
<li><strong>åç«¯å¼€å‘æ€è€ƒ</strong>ï¼šæ¶æ„è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ã€ä»£ç è´¨é‡ç­‰</li>
<li><strong>Debugç»éªŒ</strong>ï¼šå®é™…é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</li>
<li><strong>æŠ€æœ¯å­¦ä¹ </strong>ï¼šå­¦ä¹ æ–°æŠ€æœ¯çš„å¿ƒå¾—å’Œæ€»ç»“</li>
<li><strong>è¸©å‘è®°å½•</strong>ï¼šé‚£äº›è®©äººå¤´ç–¼çš„bugå’Œè§£å†³æ–¹æ¡ˆ</li>
</ul>
<h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>å¸Œæœ›è¿™ä¸ªåšå®¢èƒ½è§è¯æˆ‘çš„æŠ€æœ¯æˆé•¿ï¼Œä¹Ÿå¸Œæœ›èƒ½ä¸ºå…¶ä»–å¼€å‘è€…æä¾›ä¸€äº›å‚è€ƒï¼ˆè™½ç„¶ç°åœ¨è¿˜æ˜¯ä¸ªèœé¸Ÿå“ˆå“ˆå“ˆï¼‰ã€‚</p>
<p>è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚</p>
<p>PS: å¦‚æœæ–‡ç« æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼æ¯•ç«Ÿè¿˜åœ¨å­¦ä¹ ä¸­ï¼Œéš¾å…ä¼šæœ‰ç†è§£ä¸åˆ°ä½çš„åœ°æ–¹ ğŸ˜Š</p>
]]></content>
      <categories>
        <category>éšä¾¿è¯´è¯´</category>
      </categories>
      <tags>
        <tag>éšç¬”</tag>
        <tag>åç«¯å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2024/11/03/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>ç”¨æˆ·ä¸­å¿ƒé¡¹ç›®è¸©å‘è®°ï¼šç™»å½•æ€ç®¡ç†çš„é‚£äº›å‘</title>
    <url>/2024/11/20/2024-11-20-login-session/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é¡¹ç›®åˆåˆåˆæœ‰é—®é¢˜ï¼Œæµè§ˆå™¨åˆ·æ–°ä¸€ä¸‹å°±å¾—é‡æ–°ç™»å½•ï¼Œæ‰‹æœºå’Œç”µè„‘ä¹Ÿæ— æ³•å…±äº«çŠ¶æ€ã€‚ä½œä¸ºä¸€ä¸ªå¤§äºŒå­¦ç”Ÿï¼Œåªèƒ½è¯´å®Œå…¨å°±æ˜¯å•¥ä¹Ÿä¸ä¼šï¼Œåªèƒ½ä¸€ç‚¹ç‚¹åœ°æŸ¥èµ„æ–™ã€‚æœ¬æ–‡è®°å½•æˆ‘å¦‚ä½•æŠŠé›¶æ•£çš„ Session æ”¹æˆåŸºäº Redis çš„ Token æ–¹æ¡ˆï¼Œå¸Œæœ›ç»™ä¹Ÿåœ¨è‡ªå­¦çš„åŒå­¦ä¸€ç‚¹å‚è€ƒã€‚</p>
<h2 id="é—®é¢˜ç°è±¡ï¼šç™»å½•æ€â€œç¨çºµå³é€â€"><a href="#é—®é¢˜ç°è±¡ï¼šç™»å½•æ€â€œç¨çºµå³é€â€" class="headerlink" title="é—®é¢˜ç°è±¡ï¼šç™»å½•æ€â€œç¨çºµå³é€â€"></a>é—®é¢˜ç°è±¡ï¼šç™»å½•æ€â€œç¨çºµå³é€â€</h2><p>æœ€å¼€å§‹æˆ‘ç›´æ¥ç”¨ Spring Boot è‡ªå¸¦çš„ <code>HttpSession</code> ä¿å­˜ç”¨æˆ·å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginRequest request, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.login(request.getAccount(), request.getPassword());</span><br><span class="line">    session.setAttribute(<span class="string">&quot;user&quot;</span>, user); <span class="comment">// æ˜æ˜å­˜äº†ï¼Œä½†æ€»ä¸¢</span></span><br><span class="line">    <span class="keyword">return</span> Result.success(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éšä¹‹æš´éœ²äº†ä¸‰ä¸ªç—›ç‚¹ï¼š</p>
<ol>
<li>å‰ç«¯ç”¨ Reactï¼Œåˆ·æ–°é¡µé¢å Session ä¸¢å¤±ï¼Œç”¨æˆ·å¾—é‡æ–°ç™»å½•ï¼ˆæœ¬åœ°ä¸¤ä¸ªæµè§ˆå™¨çª—å£å°±èƒ½ç¨³å®šå¤ç°ï¼‰ï¼›</li>
<li>æˆ‘é‡å¯åç«¯æœåŠ¡ï¼Œæ‰€æœ‰ç”¨æˆ·å…¨è¢«è¸¢ä¸‹çº¿ï¼ˆå¼€å‘ç¯å¢ƒé‡å¯ä¸€æ¬¡å°±å¾—é‡æ–°ç™»å½•ä¸€éï¼‰ï¼›</li>
<li>åŒä¸€è´¦å· PC ç™»å½•åï¼Œæ‰‹æœºç«¯å®Œå…¨æ„ŸçŸ¥ä¸åˆ°çŠ¶æ€ï¼ˆæˆ‘ç”¨åŒä¸€ Wi-Fi ä¸‹çš„æ‰‹æœºè®¿é—®æœ¬åœ°è°ƒè¯•åœ°å€éªŒè¯çš„ï¼‰ã€‚</li>
</ol>
<h2 id="è§£å†³è¿‡ç¨‹ï¼šRedis-Token"><a href="#è§£å†³è¿‡ç¨‹ï¼šRedis-Token" class="headerlink" title="è§£å†³è¿‡ç¨‹ï¼šRedis + Token"></a>è§£å†³è¿‡ç¨‹ï¼šRedis + Token</h2><h3 id="1-æŠ€æœ¯é€‰å‹"><a href="#1-æŠ€æœ¯é€‰å‹" class="headerlink" title="1. æŠ€æœ¯é€‰å‹"></a>1. æŠ€æœ¯é€‰å‹</h3><p>æˆ‘è°ƒç ”äº†ä¸‰ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>åŸç”Ÿ Session</strong>ï¼šä¾èµ–å•æœºå†…å­˜ï¼Œé‡å¯æˆ–å¤šå®ä¾‹æ—¶ä¼šæ··ä¹±ï¼›</li>
<li><strong>JWT</strong>ï¼šæ— çŠ¶æ€ä½†æ— æ³•ä¸»åŠ¨å¤±æ•ˆï¼Œå¯¹æˆ‘ç°åœ¨çš„éœ€æ±‚æ¥è¯´ä¸å¥½æ§åˆ¶ï¼›</li>
<li><strong>Redis + Token</strong>ï¼šç™»å½•åç”Ÿæˆ Tokenï¼ŒæŠŠç”¨æˆ·ä¿¡æ¯æ”¾åˆ° Redisï¼Œå¯æ§å¯å¤±æ•ˆï¼Œè¿˜èƒ½æ‰©å±•åˆ°å¤šèŠ‚ç‚¹ã€‚</li>
</ul>
<p>ç»¼åˆå¤æ‚åº¦å’Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘é€‰æ‹©ç¬¬ä¸‰ç§ã€‚</p>
<h3 id="2-å¼•å…¥-Redis-ä¾èµ–"><a href="#2-å¼•å…¥-Redis-ä¾èµ–" class="headerlink" title="2. å¼•å…¥ Redis ä¾èµ–"></a>2. å¼•å…¥ Redis ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-é…ç½®-Redis-è¿æ¥"><a href="#3-é…ç½®-Redis-è¿æ¥" class="headerlink" title="3. é…ç½® Redis è¿æ¥"></a>3. é…ç½® Redis è¿æ¥</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°ç”¨ Docker èµ·äº†ä¸€ä¸ª Redisï¼Œæ­£å¼ç¯å¢ƒä¹Ÿèƒ½ç›´æ¥å¤ç”¨é…ç½®ã€‚</p>
<h3 id="4-Token-å·¥å…·ç±»"><a href="#4-Token-å·¥å…·ç±»" class="headerlink" title="4. Token å·¥å…·ç±»"></a>4. Token å·¥å…·ç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateToken</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;USER_TOKEN:&quot;</span> + UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">storeToken</span><span class="params">(String token, UserDTO user)</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(token,</span><br><span class="line">                JSON.toJSONString(user),</span><br><span class="line">                <span class="number">2</span>,</span><br><span class="line">                TimeUnit.HOURS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">verifyToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> redisTemplate.opsForValue().get(token);</span><br><span class="line">        <span class="keyword">if</span> (userJson == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        redisTemplate.expire(token, <span class="number">2</span>, TimeUnit.HOURS);</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(userJson, UserDTO.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘åœ¨è¿™é‡Œåˆ»æ„ç”¨äº† <code>UserDTO</code>ï¼ŒæŠŠå¯†ç å“ˆå¸Œç­‰æ•æ„Ÿå­—æ®µå»æ‰ï¼Œé¿å… Redis é‡Œå­˜å…¨é‡å¯¹è±¡ã€‚è™½ç„¶æš‚æ—¶è¿˜æ²¡éƒ¨ç½²ï¼Œä½†è¶æ—©æŠŠæ•æ„Ÿå­—æ®µå‰¥ç¦»æ‰ä¹Ÿèƒ½é¿å…åé¢è¿ç§»æ—¶æ‰‹å¿™è„šä¹±ã€‚</p>
<h3 id="5-æ”¹é€ ç™»å½•æ¥å£"><a href="#5-æ”¹é€ ç™»å½•æ¥å£" class="headerlink" title="5. æ”¹é€ ç™»å½•æ¥å£"></a>5. æ”¹é€ ç™»å½•æ¥å£</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginRequest request)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.login(request.getAccount(), request.getPassword());</span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">safeUser</span> <span class="operator">=</span> UserConvertor.toDTO(user);</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> tokenUtils.generateToken(user.getId());</span><br><span class="line">    tokenUtils.storeToken(token, safeUser);</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="keyword">new</span> <span class="title class_">LoginResponse</span>(token, safeUser));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‰ç«¯æ‹¿åˆ° Token åå†™å…¥ <code>localStorage</code>ï¼Œè¯·æ±‚æ—¶æ”¾åˆ° <code>Authorization</code> å¤´é‡Œã€‚ç°é˜¶æ®µåªæ˜¯æˆ‘è‡ªå·±åœ¨æµè§ˆå™¨é‡Œè°ƒè¯•ï¼Œä½†ç­‰ä»¥åéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒåªéœ€è¦æŠŠåŸºå€è°ƒä¸€ä¸‹å°±èƒ½ç»§ç»­æ²¿ç”¨ã€‚</p>
<h3 id="6-æ‹¦æˆªå™¨æ ¡éªŒç™»å½•æ€"><a href="#6-æ‹¦æˆªå™¨æ ¡éªŒç™»å½•æ€" class="headerlink" title="6. æ‹¦æˆªå™¨æ ¡éªŒç™»å½•æ€"></a>6. æ‹¦æˆªå™¨æ ¡éªŒç™»å½•æ€</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenUtils tokenUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                             HttpServletResponse response,</span></span><br><span class="line"><span class="params">                             Object handler)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(token)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;æœªç™»å½•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> tokenUtils.verifyToken(token);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;ç™»å½•å·²è¿‡æœŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        UserContext.set(user); <span class="comment">// ThreadLocal ä¿å­˜ï¼Œæ–¹ä¾¿åç»­è·å–</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>WebMvcConfigurer</code> é‡ŒæŠŠæ‹¦æˆªå™¨æ³¨å†Œåˆ°éœ€è¦é‰´æƒçš„æ¥å£å³å¯ã€‚</p>
<h2 id="è¸©å‘è®°å½•"><a href="#è¸©å‘è®°å½•" class="headerlink" title="è¸©å‘è®°å½•"></a>è¸©å‘è®°å½•</h2><ul>
<li><strong>Token ä¼ é€’æ–¹å¼</strong>ï¼šæœ€æ—©æ”¾åœ¨ URL æŸ¥è¯¢å‚æ•°ï¼Œåˆ·æ–°å’Œå¤åˆ¶é“¾æ¥éƒ½ä¼šæ³„éœ²ï¼Œæœ€åæ”¹æˆ <code>Authorization</code> å¤´ï¼›</li>
<li><strong>Redis åºåˆ—åŒ–</strong>ï¼šé»˜è®¤ <code>JdkSerializationRedisSerializer</code> è®© Key å‡ºç°ä¹±ç ï¼Œæˆ‘ç»Ÿä¸€æ”¹ç”¨ <code>StringRedisTemplate</code> + JSONï¼›</li>
<li><strong>ä¸»åŠ¨ä¸‹çº¿</strong>ï¼š<code>verifyToken</code> å¤±è´¥æ—¶ç›´æ¥æŠ›å¼‚å¸¸ï¼Œè¿™æ ·ç”¨æˆ·åœ¨åˆ«çš„è®¾å¤‡ç™»å½•ä¼šè§¦å‘æ—§ Token å¤±æ•ˆï¼›</li>
<li><strong>è¶…æ—¶ç»­æœŸ</strong>ï¼šæ¯æ¬¡éªŒè¯æˆåŠŸååˆ·æ–°è¿‡æœŸæ—¶é—´ï¼Œç”¨æˆ·åªè¦æ´»è·ƒå°±ä¸ä¼šè¢«è¸¢ã€‚</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¬¡æŸ¥äº†ä¸å°‘èµ„æ–™è®©æˆ‘ç†è§£äº†â€œç™»å½•æ€&#x3D;å¦‚ä½•å®‰å…¨è®°ä½ç”¨æˆ·â€ã€‚åŸç”Ÿ Session åœ¨å•æœºè°ƒè¯•è¿˜è¡Œï¼Œä½†é‡åˆ°å¤šç«¯ã€å¤šå®ä¾‹å°±åŠ›ä¸ä»å¿ƒï¼Œæ›´åˆ«è¯´ä»¥åä¸Šçº¿éƒ¨ç½²ï¼ˆå¯èƒ½æœ‰å§ ã€‚Redis + Token è™½ç„¶å¤šå†™äº†ç‚¹ä»£ç ï¼Œå´è§£å†³äº†åˆ·æ–°ã€é‡å¯ã€åˆ†å¸ƒå¼å’Œä¸»åŠ¨å¤±æ•ˆçš„é—®é¢˜ã€‚ä¸‹ä¸€ç¯‡ç»§ç»­è®°å½•åœ¨è¿™ä¸ªé¡¹ç›®ä¹Ÿç®—æ˜¯ç£ä¿ƒè‡ªå·±è¿›æ­¥äº†ï¼Œå¸Œæœ›è¿˜èƒ½åšæŒå†™ä¸‹å»ã€‚</p>
]]></content>
      <categories>
        <category>Debug ç»éªŒ</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>Session</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨æˆ·ä¸­å¿ƒé¡¹ç›®è¸©å‘è®°ï¼šå¯†ç åŠ å¯†é‚£äº›äº‹å„¿</title>
    <url>/2024/11/15/2024-11-15-password-security/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ˜¯æˆ‘åšçš„ç¬¬ä¸€ä¸ªé¡¹ç›®ã€‚å‰å‡ å¤©æˆ‘å¯¹å®‰å…¨çš„ç†è§£åªåœç•™åœ¨â€œåˆ«å†™å‡º bug å°±è¡Œâ€ã€‚ç›´åˆ°åœ¨æµ‹è¯•æ•°æ®åº“æ—¶ï¼Œäº²çœ¼çœ‹åˆ° <code>user_password</code> å­—æ®µé‡Œèººç€ä¸€ä¸²ä¸²æ˜æ–‡å¯†ç ï¼Œæ‰æƒ³èµ·ä¹‹å‰åˆ·åˆ°çš„è§†é¢‘é‡Œä¸€å¥è¯ï¼šâ€œæ˜æ–‡å¯†ç  &#x3D; çº¢çº¿â€ã€‚æœ¬æ–‡è®°å½•æˆ‘ä»æ˜æ–‡å­˜å‚¨åˆ°ä½¿ç”¨ BCrypt çš„å…¨è¿‡ç¨‹ï¼Œç•™ç»™ä¹Ÿåœ¨è‹¦è‹¦å†™é¡¹ç›®çš„åŒå­¦åšå‚è€ƒã€‚</p>
<h2 id="é—®é¢˜çˆ†å‘ï¼šæ•°æ®åº“é‡Œçš„â€œè£¸å¥”â€å¯†ç "><a href="#é—®é¢˜çˆ†å‘ï¼šæ•°æ®åº“é‡Œçš„â€œè£¸å¥”â€å¯†ç " class="headerlink" title="é—®é¢˜çˆ†å‘ï¼šæ•°æ®åº“é‡Œçš„â€œè£¸å¥”â€å¯†ç "></a>é—®é¢˜çˆ†å‘ï¼šæ•°æ®åº“é‡Œçš„â€œè£¸å¥”â€å¯†ç </h2><p>é¡¹ç›®åˆæœŸæˆ‘åªæƒ³å…ˆè·‘é€šæµç¨‹ï¼Œç›´æ¥æŠŠå‰ç«¯ä¼ æ¥çš„å¯†ç ä¸¢è¿›æ•°æ®åº“ã€‚æ§åˆ¶å±‚ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç¤ºèŒƒï¼Œè¯·å‹¿æ¨¡ä»¿</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">register</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user.getPassword().length() &lt; <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;å¯†ç é•¿åº¦ä¸è¶³&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    userMapper.insert(user); <span class="comment">// ç›´æ¥å­˜æ˜æ–‡</span></span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ç”¨ Navicat æ‰“å¼€æ•°æ®è¡¨ï¼Œ<code>&quot;12345678&quot;</code>ã€<code>&quot;abcdefg&quot;</code> ç­‰å¼±å¯†ç å…¨åœ¨é‡Œé¢ã€‚æ­¤åˆ»æˆ‘æ‰æ„è¯†åˆ°ï¼šå¦‚æœæ•°æ®åº“è¢«æ‹–åº“ï¼Œæ‰€æœ‰ç”¨æˆ·è´¦å·éƒ½ä¼šæš´éœ²ã€‚</p>
<h2 id="è§£å†³è¿‡ç¨‹ï¼šBCrypt-çš„æ•‘èµ"><a href="#è§£å†³è¿‡ç¨‹ï¼šBCrypt-çš„æ•‘èµ" class="headerlink" title="è§£å†³è¿‡ç¨‹ï¼šBCrypt çš„æ•‘èµ"></a>è§£å†³è¿‡ç¨‹ï¼šBCrypt çš„æ•‘èµ</h2><h3 id="1-é€‰å‹"><a href="#1-é€‰å‹" class="headerlink" title="1. é€‰å‹"></a>1. é€‰å‹</h3><p>æŸ¥èµ„æ–™åé”å®šå‡ ä¸ªå¸¸è§æ–¹æ¡ˆï¼š</p>
<ul>
<li><code>MD5</code>ï¼šä¸å¯é€†ï¼Œä½†å½©è™¹è¡¨å’Œ GPU æš´åŠ›ç ´è§£å¤ªå¿«ï¼›</li>
<li><code>SHA</code>ï¼šåŒæ ·å±äºå¿«é€Ÿå“ˆå¸Œï¼Œå¯¹å¯†ç ä¿æŠ¤ä¸å¤Ÿï¼›</li>
<li><code>BCrypt</code>ï¼šè‡ªå¸¦ç›å€¼ï¼Œè®¡ç®—æ…¢ï¼Œå¯æ‹–æ…¢æš´åŠ›ç ´è§£ã€‚</li>
</ul>
<p>ç»“åˆ Spring ç”Ÿæ€ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨ <code>BCryptPasswordEncoder</code>ï¼Œä¸å¿…è‡ªå·±ç»´æŠ¤ç›å€¼ï¼Œæ•´åˆä¹Ÿå¾ˆé¡ºã€‚</p>
<h3 id="2-ä»£ç æ”¹é€ "><a href="#2-ä»£ç æ”¹é€ " class="headerlink" title="2. ä»£ç æ”¹é€ "></a>2. ä»£ç æ”¹é€ </h3><p><strong>å¼•å…¥ä¾èµ–</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ³¨å†ŒåŠ å¯† Bean</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ”¹é€ æ³¨å†Œ &#x2F; ç™»å½•é€»è¾‘</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encodedPassword</span> <span class="operator">=</span> passwordEncoder.encode(user.getPassword());</span><br><span class="line">        user.setPassword(encodedPassword);</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String account, String password)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectByAccount(account);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!passwordEncoder.matches(password, user.getPassword())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-æ–°å‘ï¼šå­—æ®µé•¿åº¦ä¸å¤Ÿ"><a href="#3-æ–°å‘ï¼šå­—æ®µé•¿åº¦ä¸å¤Ÿ" class="headerlink" title="3. æ–°å‘ï¼šå­—æ®µé•¿åº¦ä¸å¤Ÿ"></a>3. æ–°å‘ï¼šå­—æ®µé•¿åº¦ä¸å¤Ÿ</h3><p>BCrypt ç”Ÿæˆçš„å“ˆå¸Œå¤§çº¦ 60 ä¸ªå­—ç¬¦ï¼Œè€Œæˆ‘çš„ <code>user_password</code> æ˜¯ <code>varchar(50)</code>ã€‚æ’å…¥æ—¶æŠ¥é”™ï¼Œåªèƒ½èµ¶ç´§è¿è¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="keyword">user</span></span><br><span class="line">MODIFY <span class="keyword">COLUMN</span> user_password <span class="type">VARCHAR</span>(<span class="number">60</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;å¯†ç å“ˆå¸Œ&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¬¡è¸©å‘çš„æ”¶è·ï¼š</p>
<ul>
<li>æ˜æ–‡å¯†ç ç»å¯¹ä¸èƒ½å…¥åº“ï¼ŒBCrypt æ˜¯ä¸Šæ‰‹å‹å¥½çš„æ–¹æ¡ˆï¼›</li>
<li>å“ˆå¸Œå­—ç¬¦ä¸²ä¼šæ›´é•¿ï¼Œåº“è¡¨å­—æ®µè¦é¢„ç•™ç©ºé—´ï¼›</li>
<li>å–„ç”¨æ¡†æ¶æä¾›çš„å·¥å…·ï¼Œåˆ«é‡å¤é€ è½®å­ã€‚</li>
</ul>
<p>ä¸‹ä¸€ç¯‡æˆ‘åº”è¯¥è¿˜ä¼šè®°å½•åœ¨è¿™ä¸ªé¡¹ç›®é‡åˆ°çš„å…¶ä»–é—®é¢˜ï¼Œå¸Œæœ›è¿˜èƒ½åšæŒå†™ä¸‹å»ï¼Œæ¬¢è¿å‚¬æ›´ï¼</p>
]]></content>
      <categories>
        <category>Debug ç»éªŒ</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>å®‰å…¨</tag>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
</search>
